# About zdemo schemas set

Zdemo contains files and folders which follow a standard
pattern expected for a "set" of schemas. A schema should
never be in a schema root. A set can optionally use sub-folders
to group related schema.

## Schemas

This file acts as an overview because each group and schema
in the set should provide an readme.md with details. It ends
with as list of major changes to this set.

* Status: *draft | ~~accepted~~ | ~~published~~*
* Schema set maintainer: *Martin Comina*

This set remains draft until all schemas within are close
to version 1.0.0 and final acceptance is due. A published
status indicates **all future changes** to a committed
schema should get a point version.  A command exists
to detect schema version changes and optionally git add
the new files.

### Building 

1. Confirm in repository root folder
2. Run **./sroot/zdemo/build.sh** and all "current"
   versions of all schemas in this set will be built. If
   version in schema $id was not changed this command
   will **overwrite** the last run. If the last run
   was committed there should be **NO** differences
   except for file timestamps.

### Available top and child schemas

The following top $id are available and applications
should cache versions they need. A "top" schema is
self-contained and requires no external schemas.

* **/zdemo/pattern1/top/** (uses two children to define itself)

The following child $id are available which are
reused by schemas inside this set. A schema at 1.0.0
or newer can be used by schemas in other sets.

* **/zdemo/pattern1/child/one/** (schema defining itself and expected
  in many top schemas)

* **/zdemo/pattern1/child/two/** (like one BUT adding properties
  defined by three)

* **/zdemo/pattern1/child/three/** (schema with only properties it
defines, so is the smallest reusable fragment.)

## Extra notes about zdemo schema set 

All schemas defined in this set **MUST NOT** be used outside
of this set. In contrast, other sets should assume all top/child
schemas they define (which have reached version 1.0.0) are
being reused by other sets within a schema root.

### empty - a standard folder for creating a new schema

The zdemo set provide a folder for copying into other
schema sets. It provides the minimum files to get started
with version 0.0.1 of a new schema. Failure to read 
[empty readme](empty/readme.md) (which highlights what
to edit in the "current" file) will cause step 3 below to fail.

* **/zdemo/empty/** (standard folder for new schema in repository using current.yaml)
* **/zdemo/emptyj/** (standard folder for new schema in repository using current.json)

### How to confirm or detect changes to valid schemas

An aim of this folder is to enable schema writers to learn
how changes to files alter generated files. It provides a
reusable scheme (with examples) that different applications
can use to check core logic against.

1. Confirm in repository root folder.

2. Run **./sroot/zdemo/build.sh** which will overwrite
   version 0.0.1 files unless values in an $id were changed.

3. Run **npm run test** to confirm schema set pass minimum checks
   and will work with javascript front end applications

4. Run **./check.py zdemo** to confirm schemas will work
   with Python backends.

5. Run **./sroot/zdemo/reset.sh** to delete all versions (0.0.x)
   generated by step 2. Do manual delete if major or minor
   value were changed.

#### Build tools

The 2nd and 3rd steps require the installation of node.js
and npm. Step 4 requires Python virtual environment.

1. https://docs.npmjs.com/downloading-and-installing-node-js-and-npm

2. Confirm in repository root folder and run *npm install*

3. Confirm CLI is working: npx jsonschema-tools --version

4. For Python, create and activate a virtual environment and
run *./install.sh* to pip install required packages.

#### Doing schema check inside container

The Dockerfile uses the same container image that the wikimedia
primary root users. It copies configuration and adds the
schema folder before running test. 

* Whilst in project root: docker/podman build -t jsonschematools .

If container build completes all schemas passed all tests.

#### Schema check within github workflows

All local checks should pass before being committed or
pushed to remote. However, github actions are used to
confirm pushes or pull requests pass the checks.

### Pattern 9: schema group showing change over time

Pattern 9 shows how schema releases can evolve at
different speeds. The [pattern9 readme](pattern9/readme.md)
documents how to modify one or more existing schemes and
build all changes with single command. You should have
created at least one schema manually and review of
pattern 1 is suggested.

## Changes

Major changes to the zdemo schema

### March 2024

* Added two shell scripts to build and reset schema set. A
  similar script should exist in schema sets.
* Added version 0.0.1 of empty schema.
* Added schema design pattern 1 (top mostly defined by children
  and those children reuses a child)
* Added design pattern 9 (schemas evolve at different speeds)
